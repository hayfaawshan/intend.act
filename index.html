<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Today-Upcoming</title>
    <link rel="stylesheet" href="css/custom.css">
    <link rel="stylesheet" href="css/index.css">
	</head>
	<body>
    <!--Nav Bar-->
		<section>
			<div class="container.is-fullhd">
				<nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
					<div class="navbar-menu">
						<div class="navbar-start">
							<div class="navbar-brand">
								<a class="navbar-item" href="https://codefirstgirls.org.uk/">
									<img src="../assets/CFG.jpg" />
								</a>
								<a class="navbar-item">
									<img src="../assets/vodafone.jpg" />
                </a>
                <h4 class="intend-act"> intend. act.</h4>
              </div>

						</div>

						<div class="navbar-end">
							<a class="navbar-item" href="community-home.html">
									<img src="../assets/home.png">
							</a>
							<a class="navbar-item">
								<img src="../assets/settings.jpg">
							</a>
						</div>
					</div>
					</div>
				</nav>
    </section>

    <!--Hero Title -->
    <section class="hero">
      <div class="hero-body">
        <div class="container">
          <h1 class="title header">
            today & upcoming
          </h1>
        </div>
      </div>
		</section>

     <!--Clock Image -->
     <figure class="media">
        <img src="assets/clock.jpg" class="floatRight">
    </figure>

    <figure class="media">
      <a href="journeys/journeys-home.html">
        <img src="assets/arrow.jpg" class="arrowLeft">
      </a>
      <a href="community/community-home.html">
        <img src="assets/arrow.jpg" class="arrowRight">
      </a>

  </figure>

    <section class="section">
      <div id="react-container"></div>
    </section>

    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script type="text/babel">


      const currentEvents = JSON.parse(localStorage.getItem('events') || '[]');

      function TaskLine({ text }) {
        return <li class="intentionText">{text} <input class="checkboxLeft" type="checkbox"/></li>;
      }

      function TodayRow({text,date}) {
        return (
          <tr>
            <td>{text}</td>
            <td>{date}</td>
            <td><input type="checkbox"/></td>
          </tr>
        );
      }

      function UpcomingRow({text,date}) {
        return (
          <tr>
            <td>{text}</td>
            <td>{date}</td>
          </tr>
        );
      }


      class TodayUpcomingPage extends React.Component {
        constructor(props) {
          super(props);
          this.state = {
            intentionText: '',
            currentIntentions: [],
            currentEvents: []
          };
        }

        componentDidMount() {
          this.setState({
            ...this.state,
            currentIntentions: JSON.parse(localStorage.getItem('intentions') || '[]'),
          });
        }

        render() {

          const intentionDates = this.state.currentIntentions.map(intention => intention.date);
          const splitIntentionDates = intentionDates.map(date => date.split("T")[0]);
          const eventDates = currentEvents.map(event => event.date);
          let todaysList = [];
          let upcomingList = [];
          let pastList = [];

          for (let i = 0; i < splitIntentionDates.length; i++) {
              if (splitIntentionDates[i] === (new Date()).toISOString().split("T")[0]) {
              todaysList.push(this.state.currentIntentions[i]);
            } else if (splitIntentionDates[i] > (new Date()).toISOString().split("T")[0]) {
              upcomingList.push(this.state.currentIntentions[i]);
            } else {
              pastList.push(this.state.currentIntentions[i]);
            }
          }

          for (let i = 0; i < eventDates.length; i++) {
            if (eventDates[i] === (new Date()).toISOString().split("T")[0]) {
              todaysList.push(currentEvents[i]);
            } else if (eventDates[i] > (new Date()).toISOString().split("T")[0]) {
              upcomingList.push(currentEvents[i]);
            } else {
              upcomingList.push(currentEvents[i]);
            }
          }

          return (
            <div>
                <h1>Today &amp; Upcoming</h1>
                <h2>today</h2>
                <table>
                  <thead>
                      <tr>
                          <th>Intention/Event</th>
                          <th>Date</th>
                          <th>Complete?</th>
                      </tr>
                  </thead>
                  <tbody>
                    {todaysList.map(item => <TodayRow text={item.text} date={item.date}/>)}
                  </tbody>
              </table>

                <h2>upcoming</h2>
                <table>
                  <thead>
                      <tr>
                          <th>Intention/Event</th>
                          <th>Date</th>
                      </tr>
                  </thead>
                  <tbody>
                    {upcomingList.map(item => <UpcomingRow text={item.text} date={item.date}/>)}
                  </tbody>
              </table>
		</div>
          );
        }
      }

      const reactContainer = document.getElementById('react-container');
      ReactDOM.render(React.createElement(TodayUpcomingPage), reactContainer);

    </script>
	</body>
</html>
